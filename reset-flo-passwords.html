<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Reset Passwords Agence Flo</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body style="background: #000; color: #0f0; font-family: monospace; padding: 50px;">
    <h1>Reset Passwords - Agence Flo VAs</h1>
    <button onclick="resetPasswords()" style="padding: 20px; font-size: 18px; background: #0f0; color: #000; border: none; cursor: pointer;">
        RESET PASSWORDS
    </button>
    <pre id="log" style="margin-top: 20px; background: #111; padding: 20px; border: 1px solid #0f0;"></pre>

    <script>
        const SERVICE_ROLE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZqc292bmhtamdlaHFhd2ptcXhuIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MDQyNDg5OCwiZXhwIjoyMDc2MDAwODk4fQ.NQtRBw8KSlPFrpvINev80X4A17BIMFnbQ2r_8FLRdYM';
        const adminClient = window.supabase.createClient('https://vjsovnhmjgehqawjmqxn.supabase.co', SERVICE_ROLE_KEY);

        function log(msg) {
            document.getElementById('log').textContent += msg + '\n';
        }

        async function resetPasswords() {
            log('Starting password reset...\n');

            const vasPasswords = [
                { email: 'adelain@agenceflo.com', password: 'adelain123' },
                { email: 'aures@agenceflo.com', password: 'aures123' },
                { email: 'fifi@agenceflo.com', password: 'fifi123' },
                { email: 'hugo@agenceflo.com', password: 'hugo123' },
                { email: 'jaures@agenceflo.com', password: 'jaures123' },
                { email: 'moi@agenceflo.com', password: 'moi123' },
                { email: 'yisse@agenceflo.com', password: 'yisse123' }
            ];

            for (const va of vasPasswords) {
                try {
                    const { data: usersData, error: listError } = await adminClient.auth.admin.listUsers();

                    if (listError) {
                        log(`❌ ${va.email}: Error listing users - ${listError.message}`);
                        continue;
                    }

                    const user = usersData.users.find(u => u.email === va.email);

                    if (!user) {
                        log(`❌ ${va.email}: User not found`);
                        continue;
                    }

                    const { error: updateError } = await adminClient.auth.admin.updateUserById(user.id, {
                        password: va.password
                    });

                    if (updateError) {
                        log(`❌ ${va.email}: ${updateError.message}`);
                    } else {
                        log(`✅ ${va.email} → password: ${va.password}`);
                    }

                } catch (error) {
                    log(`❌ ${va.email}: ${error.message}`);
                }
            }

            log('\n✅ DONE!');
        }
    </script>
</body>
</html>
